(()=>{"use strict";var e={169:(e,t,r)=>{r.d(t,{h:()=>a});var o=r(725);class a extends o.h{constructor(e="Karsai autó",t="",r=800){super(),this.root=document.createElement("div"),this.root.classList.add("form-popup"),this.layer=document.createElement("div"),this.layer.classList.add("form-popup-layer");const o=document.createElement("style");o.innerText=`.form-popup-layer { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.2); } .form-popup { width: ${r}px; background: white; position: absolute; top: 0; left: 50%; transition: 0.5s; transform: translateX(-50%); box-shadow: 0 10px 10px rgba(0, 0, 0, 0.2); opacity: 0; pointer-events: none; } .form-popup.active { opacity: 1; top: 120px; pointer-events: all; } .form-popup .card-footer { display: flex; justify-content: flex-end; }`,document.head.appendChild(o),document.body.appendChild(this.layer),this.layer.style.zIndex=(this.maxZIndex+1).toString(),document.body.appendChild(this.root),this.root.style.zIndex=(this.maxZIndex+1).toString();const a=new MutationObserver((e=>{const t=this.root.querySelector("div.close-box");t&&(t.onclick=()=>this.close(),t.style.cursor="pointer",this.form=this.root.querySelector("form"),a.disconnect()),requestAnimationFrame((()=>this.root.classList.add("active")))}));a.observe(this.root,{childList:!0})}close(){this.root.ontransitionend=e=>{"top"==e.propertyName&&(this.root.remove(),this.layer.remove())},this.root.classList.remove("active")}}},725:(e,t,r)=>{r.d(t,{h:()=>o});class o{url(e){return`${(window.location.origin+window.location.pathname).replace(/\/+$/,"")}/${e}`}get schema(){return{model:{id:"id",fields:{id:{type:"number"}}},data:e=>e.data||[],total:e=>e.total||0}}input(e){return document.getElementById(e)??document.createElement("button")}showFormError(e,t,r){t.querySelectorAll("div.error-box").forEach((e=>e.remove()));for(const[o,a]of Object.entries(r)){const r=t.querySelector(`div.field-${e}-${o}`),n=document.createElement("div");n.classList.add("error-box"),n.innerHTML=a[0],r&&(r.appendChild(n),requestAnimationFrame((()=>n.classList.add("show"))))}}gridButtonList(e,t){return Array.from(e.wrapper[0].querySelectorAll(`button.${t}`)).map((t=>{const r=t.closest("tr");return{button:t,row:r,data:e.dataItem(r)}}))}async fetchDelete(e,t){const r=await fetch(`${e}/${t}`,{method:"DELETE",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-Token":yii.getCsrfToken()}});let o;try{o=await r.json()}catch(e){o=null}if(200==r.status)return o;throw new Error(o?.message||"Sikertelen törlés")}async fetchForm(e,t,r=null,o=null,a=!0){return new Promise((n=>{const s=[200,201,202],i=document.createElement("div");let d;a&&(i.classList.add("popup-layer"),i.style.zIndex=(this.maxZIndex+1).toString(),document.body.appendChild(i),i.classList.add("animate")),t.append("_csrf",yii.getCsrfToken()),fetch(e,{method:"POST",body:t}).then((e=>{if(i&&i.remove(),d=e.status,(e.headers.get("Content-Type")||"").includes("application/json"))return e.json();throw new Error("A válasz nem JSON formátumú.")})).then((e=>{s.includes(d)?n(e):o&&r&&this.showFormError(o,r,e.errors)}))}))}async fetchData(e,t={},r=!0){const o=jQuery.Deferred(),a=new FormData,n=document.createElement("div");r&&(n.classList.add("popup-layer"),n.style.zIndex=(this.maxZIndex+1).toString(),document.body.appendChild(n),n.classList.add("animate")),a.append("_csrf",yii.getCsrfToken());for(const[e,r]of Object.entries(t))a.append(e,r);const s=await fetch(e,{headers:{"X-Requested-With":"XMLHttpRequest"},body:a,method:"POST"});let i;const d=s.headers.get("content-type");return i="string"==typeof d&&d.includes("application/json")?await s.json():await s.text(),n&&n.remove(),o.resolve(i),o}urlPart(e){return`${new URL(window.location.href).pathname}/${e}`}get transport(){const e={};return e._csrf=yii.getCsrfToken(),{read:{type:"POST",url:null,data:e,dataType:"json"}}}confirm(e,t){const r=jQuery.Deferred(),o=jQuery(t).kendoPopover({body:()=>`<div class="confirm-body"><i class="fa fa-question-circle"></i><div>${e}</div><div><button class="btn btn-primary btn" data-name="no-btn">Nem</button><button class="btn btn-danger btn" data-name="yes-btn">Igen</button></div></div>`,width:400,position:"left",header:()=>"Megerősítés",showOn:"click",show:e=>{const t=e.sender.popup.element?.[0]?.querySelector('button[data-name="no-btn"]');t&&(t.onclick=()=>{e.sender.hide()});const o=e.sender.popup.element?.[0]?.querySelector('button[data-name="yes-btn"]');o&&(o.onclick=()=>{r.resolve(),e.sender.hide()})},hide:()=>{document.body.querySelectorAll("div.confirm-body").forEach((e=>{e.closest("div.k-animation-container")?.remove()}))}}).data("kendoPopover");return o&&o.show(),r}button(e){return document.getElementById(e)}div(e){return document.getElementById(e)}async delete(e,t){const r=new URL(window.location.origin+"/"+this.pascalToKebab(e));r.searchParams.append("id",t.toString());try{const e=await fetch(r.toString(),{method:"DELETE",headers:{"X-CSRF-Token":yii.getCsrfToken(),Accept:"application/json"}}),t=await e.json();if(!e.ok)throw console.error("Hiba a válaszban:",t.message||"Ismeretlen hiba történt."),new Error(t.message||"Ismeretlen hiba történt.");return t}catch(e){throw console.error("DELETE hiba:",e.message),e}}get maxZIndex(){let e=0;const t=document.getElementsByTagName("*");for(let r=0;r<t.length;r++){const o=window.getComputedStyle(t[r]).zIndex,a=parseInt(o,10);isNaN(a)||(e=Math.max(e,a))}return e}navigate(e,t="_self"){const r=document.createElement("a");r.href=e,document.body.appendChild(r),r.target=t,r.click(),r.remove()}pascalToKebab(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}grid(e,t,r=!0,o=[]){return new Promise((a=>{const n=this.schema,s=this.transport;s.read.url=t;const i=new kendo.data.DataSource({pageSize:100,transport:s,schema:n}),d=jQuery(e).kendoGrid({columns:o,dataSource:i,filterable:this.filterable,height:"100%",pageable:{refresh:!0},autoBind:r}).data("kendoGrid");if(!d)throw new Error("Failed to initialize kendoGrid.");r?d.bind("dataBound",(()=>a(d))):a(d)}))}get filterable(){return{extra:!1,operators:{string:{contains:"Tartalmazza",eq:"Egyenlő"}}}}dataBound(e,t,r=!0){e.bind("dataBound",t),r&&t()}}}},t={};function r(o){var a=t[o];if(void 0!==a)return a.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var o,a=r(725),n=r(169);!function(e){e.MARKAK="Markak",e.MARKAK_FORM="MarkakForm",e.REMOVE_MARKA="RemoveMarka"}(o||(o={}));class s extends a.h{async init(){const e=await this.markakGrid(this.div("markak-grid"));this.dataBound(e,(()=>{const t=e;this.gridButtonList(t,"edit-btn").forEach((e=>{const r=e.data;e.button.onclick=async()=>{await this.markaForm({id:r.id}),t.dataSource.read()}})),this.gridButtonList(t,"remove-btn").forEach((e=>{const r=e.data;e.button.onclick=async()=>{await this.confirm(`Biztos törli a(z) ${r.name} márkát`,e.button),await this.fetchData(this.url(o.REMOVE_MARKA),{id:r.id}),t.dataSource.remove(e.data)}}))})),this.button("create-marka-btn").onclick=async()=>{await this.markaForm(),e.dataSource.read()}}async markaForm(e={}){const t=this.url(o.MARKAK_FORM),r=new n.h;r.root.innerHTML=await this.fetchData(t,e);const a=r.root.querySelector("button.save-btn");return new Promise((e=>{a.onclick=async()=>{const o=new FormData(r.form),a=await this.fetchForm(t,o,r.form,"markak");e(a),r.close()}}))}markakGrid(e){return new Promise((t=>{const r=this.url(o.MARKAK),a=this.schema,n=this.transport;n.read.url=r;const s=new kendo.data.DataSource({pageSize:100,transport:n,schema:a}),i=markakColumns;jQuery(e).kendoGrid({columns:i,dataSource:s,filterable:this.filterable,height:"100%",pageable:{refresh:!0},dataBound:e=>t(e.sender)})}))}}(new s).init()})();