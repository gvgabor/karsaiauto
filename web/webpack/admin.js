(()=>{"use strict";var e={169:(e,t,a)=>{a.d(t,{h:()=>n});var o=a(725);class n extends o.h{constructor(e="Karsai autó",t="",a=800){super(),this.prev=document.querySelector("div.form-popup"),this.prev&&this.prev.classList.add("back"),this.root=document.createElement("div"),this.root.classList.add("form-popup"),this.root.style.width=`${a}px`,this.layer=document.createElement("div"),this.layer.classList.add("form-popup-layer");const o=document.createElement("style");o.innerText=this.style(),document.head.appendChild(o),document.body.appendChild(this.layer),this.layer.style.zIndex=(this.maxZIndex+1).toString(),document.body.appendChild(this.root),this.root.style.zIndex=(this.maxZIndex+1).toString();const n=new MutationObserver((()=>{const e=this.root.querySelector("div.close-box");e&&(e.onclick=()=>this.close(),e.style.cursor="pointer",this.form=this.root.querySelector("form"),n.disconnect()),requestAnimationFrame((()=>this.root.classList.add("active")))}));n.observe(this.root,{childList:!0})}style(){return".form-popup-layer {position: fixed;inset: 0;background: rgba(0, 0, 0, 0.2);}  .form-popup {background: transparent;position: absolute;top: 0;left: 50%;transition: 0.5s;transform: translateX(-50%) ;transform-origin: bottom;opacity: 0;pointer-events: none;}  .form-popup.back {transition-delay: 0.5s;transform: translateX(-52%) translateY(-10px)  !important;}  .form-popup > .card {opacity: 0;transition: 0.5s;}  .form-popup.active > .card {box-shadow: 0 10px 10px rgba(0, 0, 0, 0.2);border: none;opacity: 1;}  .form-popup.active {opacity: 1;top: 120px;pointer-events: all;transform: translateX(-50%) ;}  .form-popup .card-footer {display: flex;justify-content: flex-end;}  .form-popup .close-box i {transition: 0.5s;}  .form-popup .close-box:hover i {color: red;transform: rotate(360deg) scale(1.5);} "}close(){this.root.ontransitionend=e=>{"top"==e.propertyName&&(this.root.remove(),this.layer.remove(),this.prev&&this.prev.classList.remove("back"))},this.root.classList.remove("active")}}},725:(e,t,a)=>{a.d(t,{h:()=>o});class o{url(e){return`${(window.location.origin+window.location.pathname).replace(/\/+$/,"")}/${e}`}get schema(){return{model:{id:"id",fields:{}},data:e=>e.data||[],total:e=>e.total||0}}input(e){return document.getElementById(e)??document.createElement("button")}message(e){const t=Array.from(document.querySelectorAll("div.message-box")).reduce((e=>e+90),50),a=document.createElement("div");a.classList.add("message-box");const o=(new Date).toLocaleTimeString("hu-HU",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});a.style.zIndex=(this.maxZIndex+1).toString(),a.innerHTML=e+"&nbsp;"+o,a.style.top=`${t}px`,document.body.appendChild(a),a.ontransitionend=()=>{},requestAnimationFrame((()=>a.classList.add("active"))),a.onclick=()=>{a.ontransitionend=()=>a.remove(),a.classList.remove("active")},setTimeout((()=>{a.ontransitionend=()=>a.remove(),a.classList.remove("active")}),3e3)}showFormError(e,t,a){t.querySelectorAll("div.error-box").forEach((e=>e.remove()));for(const[o,n]of Object.entries(a)){const a=t.querySelector(`div.field-${e}-${o}`),r=document.createElement("div");r.classList.add("error-box"),r.style.zIndex=(this.maxZIndex+1).toString(),r.innerHTML=n[0],a&&(a.appendChild(r),requestAnimationFrame((()=>r.classList.add("show"))))}}gridButtonList(e,t){return Array.from(e.wrapper[0].querySelectorAll(`button.${t}`)).map((t=>{const a=t.closest("tr");return{button:t,row:a,data:e.dataItem(a)}}))}async fetchDelete(e,t){const a=await fetch(`${e}/${t}`,{method:"DELETE",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-Token":yii.getCsrfToken()}});let o;try{o=await a.json()}catch(e){o=null}if(200==a.status)return o;throw new Error(o?.message||"Sikertelen törlés")}async fetchForm(e,t,a=null,o=null,n=!0){return new Promise((r=>{const s=document.querySelector("div.form-popup");if(s){const e=document.createElement("div");e.classList.add("loader"),e.style.zIndex=(this.maxZIndex+1).toString(),e.innerHTML='˛<img alt="nincs" src="/images/YTup.gif">',s.appendChild(e)}const i=[200,201,202],d=document.createElement("div");let l;n&&(d.classList.add("popup-layer"),d.style.zIndex=(this.maxZIndex+1).toString(),document.body.appendChild(d),d.classList.add("animate")),t.append("_csrf",yii.getCsrfToken()),fetch(e,{method:"POST",body:t}).then((e=>{if(d&&(d.remove(),document.querySelectorAll("div.loader").forEach((e=>e.remove()))),l=e.status,(e.headers.get("Content-Type")||"").includes("application/json"))return e.json();throw new Error("A válasz nem JSON formátumú.")})).then((e=>{i.includes(l)?r(e):o&&a&&this.showFormError(o,a,e.errors)}))}))}async fetchData(e,t={},a=!0){const o=jQuery.Deferred(),n=new FormData,r=document.createElement("div");a&&(r.classList.add("popup-layer"),r.style.zIndex=(this.maxZIndex+1).toString(),document.body.appendChild(r),r.classList.add("animate")),n.append("_csrf",yii.getCsrfToken());for(const[e,a]of Object.entries(t))n.append(e,a);const s=await fetch(e,{headers:{"X-Requested-With":"XMLHttpRequest"},body:n,method:"POST"});if(403==s.status)return alert(await s.text()),document.querySelectorAll("div.form-popup-layer").forEach((e=>e.remove())),document.querySelectorAll("div.form-popup").forEach((e=>e.remove())),r&&r.remove(),!1;let i;const d=s.headers.get("content-type");return i="string"==typeof d&&d.includes("application/json")?await s.json():await s.text(),r&&r.remove(),o.resolve(i),o}urlPart(e){return`${new URL(window.location.href).pathname}/${e}`}get transport(){const e={};return e._csrf=yii.getCsrfToken(),{read:{type:"POST",url:null,data:e,dataType:"json"}}}confirm(e,t){const a=jQuery.Deferred(),o=jQuery(t).kendoPopover({body:()=>`<div class="confirm-body"><div>${e}</div><div><button class="btn btn-primary btn" data-name="no-btn">Nem</button><button class="btn btn-danger btn" data-name="yes-btn">Igen</button></div></div>`,position:"left",header:()=>"Megerősítés",showOn:"click",show:e=>{const t=e.sender.popup.element?.[0]?.querySelector('button[data-name="no-btn"]');t&&(t.onclick=()=>{e.sender.hide()});const o=e.sender.popup.element?.[0]?.querySelector('button[data-name="yes-btn"]');o&&(o.onclick=()=>{a.resolve(),e.sender.hide()})},hide:()=>{document.body.querySelectorAll("div.confirm-body").forEach((e=>{e.closest("div.k-animation-container")?.remove()}))}}).data("kendoPopover");return o&&o.show(),a}button(e){return document.getElementById(e)}div(e){return document.getElementById(e)}async delete(e,t){const a=new URL(window.location.origin+"/"+this.pascalToKebab(e));a.searchParams.append("id",t.toString());try{const e=await fetch(a.toString(),{method:"DELETE",headers:{"X-CSRF-Token":yii.getCsrfToken(),Accept:"application/json"}}),t=await e.json();return e.ok||console.error("Hiba a válaszban:",t.message||"Ismeretlen hiba történt."),t}catch(e){throw console.error("DELETE hiba:",e.message),e}}get maxZIndex(){let e=0;const t=document.getElementsByTagName("*");for(let a=0;a<t.length;a++){const o=window.getComputedStyle(t[a]).zIndex,n=parseInt(o,10);isNaN(n)||(e=Math.max(e,n))}return e}navigate(e,t="_self"){const a=document.createElement("a");a.href=e,document.body.appendChild(a),a.target=t,a.click(),a.remove()}pascalToKebab(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}grid(e,t,a=!0,o=[]){return new Promise((n=>{const r=this.schema,s=this.transport;s.read.url=t;const i=new kendo.data.DataSource({pageSize:100,transport:s,schema:r}),d=jQuery(e).kendoGrid({columns:o,dataSource:i,filterable:this.filterable,height:"100%",pageable:{refresh:!0},autoBind:a}).data("kendoGrid");if(!d)throw new Error("Failed to initialize kendoGrid.");a?d.bind("dataBound",(()=>n(d))):n(d)}))}igenNemFilter(e,t){jQuery(e).kendoDropDownList({dataValueField:"id",dataTextField:"value",optionLabel:"-----------",dataSource:new kendo.data.DataSource({data:JSON.parse(t.dataset.igennemFilter)})})}get filterable(){return{extra:!1,operators:{string:{contains:"Tartalmazza",eq:"Egyenlő"}}}}dataBound(e,t,a=!0){e.bind("dataBound",t),a&&t()}}}},t={};function a(o){var n=t[o];if(void 0!==n)return n.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,a),r.exports}a.d=(e,t)=>{for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var o,n=a(725),r=a(169);class s extends n.h{async valtoztatasForm(e,t){const a=new r.h;a.root.innerHTML=await this.fetchData(t,{id:e});const o=a.root.querySelector("button.save-btn");return new Promise((e=>{o.onclick=async()=>{const o=new FormData(a.form),n=await this.fetchForm(t,o,a.form,"felhasznalok",!0);e(n),a.close()}}))}}class i extends n.h{async hozzarendelesForm(e,t){const a=new r.h("","",1200);a.root.innerHTML=await this.fetchData(t,{id:e});const o=await this.menuElemekGrid(this.div("menu-elemek-grid"),hozzarendelesMenuColumns),n=await this.menuElemekGrid(this.div("hozzarendelt-elemek-grid"),hozzarendelveMenuColumns,e);await o.dataSource.read(),await n.dataSource.read(),this.dataBound(o,(()=>{const e=o;Array.from(e.wrapper[0].querySelectorAll('td[data-name="hozzaad-td"]')).forEach((t=>{const a=t.closest("tr"),o=e.dataItem(a),r=e.dataSource,s=r.childNodes(o),i=[];let d=r.parentNode(o);for(;d;)i.push(d),d=r.parentNode(d);0!=s.length?t.innerHTML="":(t.innerHTML='<button class="btn btn-warning edit-btn"><i class="fa-solid fa-arrow-right-long"></i></button>',t.onclick=async()=>{n.dataSource.add(o),i.forEach((e=>{n.dataSource.get(e.id)||n.dataSource.add(e)})),n.dataSource.fetch()})}))})),this.dataBound(n,(()=>{const e=n;Array.from(e.wrapper[0].querySelectorAll('td[data-name="hozzaad-td"]')).forEach((t=>{const a=t.closest("tr"),n=e.dataItem(a);0!=e.dataSource.childNodes(n).length?t.innerHTML="":(t.innerHTML='<button class="btn btn-warning edit-btn"><i class="fa-solid fa-arrow-left-long"></i></button>',t.onclick=async()=>{e.dataSource.remove(n),await e.dataSource.fetch(),this.filterGrid(e,o)})})),this.filterGrid(e,o)}));const s=a.root.querySelector("button.save-btn");return new Promise((o=>{s.onclick=async()=>{const r=new FormData,s=n.dataSource.data().toJSON().map((e=>e.id));r.append("felhasznaloiJogId",e.toString()),r.append("menuIdList",JSON.stringify(s)),r.append("action","1"),await this.fetchForm(t,r),o(void 0),a.close()}}))}filterGrid(e,t){const a=[...e.dataSource.data().toJSON()].map((e=>e.id)),o={logic:"and",filters:[]};a.forEach((e=>{o.filters.push({field:"id",operator:"neq",value:e})})),t.dataSource.filter(o),t.dataSource.fetch()}menuElemekGrid(e,t,a=null){return new Promise((o=>{const n=this.schema;n.model={id:"id",parentId:"parent_id",expanded:!0,fields:{parent_id:{nullable:!0,field:"parent_id"}}};const r=this.transport;r.read.url=this.url("Menu"),r.read.data.felhasznaloiJogId=a;const s=e.parentElement.clientHeight,i=new kendo.data.TreeListDataSource({pageSize:100,transport:r,schema:n});o(jQuery(e).kendoTreeList({columns:t,dataSource:i,filterable:!0,pageable:{refresh:!0},autoBind:!1,scrollable:!0,height:s}).data("kendoTreeList"))}))}}!function(e){e.FELHASZNALOK="Felhasznalok",e.FELHASZNALOI_JOGOK="FelhasznaloiJogok",e.FELHASZNALOK_FORM="FelhasznalokForm",e.JELSZO_VALTOZTATAS_FORM="JelszoValtoztatasForm",e.FELHASZNALOI_JOGOK_FORM="FelhasznaloiJogokForm",e.MENU="Menu",e.REMOVE_MENU="RemoveMenu",e.REMOVE_FELHASZNALO="RemoveFelhasznalo",e.REMOVE_FELHASZNALOI_JOGOK="RemoveFelhasznaloiJogok",e.MENU_FORM="MenuForm",e.HOZZARENDELES_FORM="HozzarendelesForm"}(o||(o={}));class d extends n.h{async init(){jQuery(this.div("admin-tab")).kendoTabStrip({animation:!1,navigatable:!0,activate:async e=>{const t=e.contentElement?.querySelector("div.grid");t&&("menu-grid"==t.id?jQuery(t).data("kendoTreeList")?.refresh():jQuery(t).data("kendoGrid")?.refresh())}}).data("kendoTabStrip").select(0);const e=await this.felhasznalokGrid(this.div("felhasznalok-grid")),t=await this.felhasznaloiJogokGrid(this.div("felhasznaloi-jogok-grid")),a=await this.menuGrid(this.div("menu-grid"));this.dataBound(a,(()=>{const e=a;e.autoFitColumn("sorrend"),Array.from(e.wrapper[0].querySelectorAll('td[data-name="edit-td"]')).forEach((t=>{t.innerHTML="<button class=\"btn btn-warning edit-btn\"><i class='fa fa-pen-alt'></i></button>";const a=t.closest("tr"),o=e.dataItem(a);t.onclick=async()=>{await this.menuForm({id:o.id}),e.dataSource.read()}})),Array.from(e.wrapper[0].querySelectorAll('td[data-name="delete-td"]')).forEach((t=>{const a=t.closest("tr"),n=e.dataItem(a);n.hasChild?t.innerHTML="":(t.innerHTML="<button class=\"btn btn-danger remove-btn\"><i class='fa fa-trash-alt'></i></button>",t.onclick=async()=>{await this.confirm(`Biztosan törli a <strong>${n.menu_name}</strong> elemet?`,t),await this.fetchDelete(this.url(o.REMOVE_MENU),n.id),e.dataSource.read()})}))})),this.dataBound(t,(()=>{const e=t;this.gridButtonList(e,"edit-btn").forEach((t=>{const a=t.data;t.button.onclick=async()=>{const t=await this.felhasznaloiJogokForm({id:a.id});e.dataSource.pushUpdate(t.model)}})),this.gridButtonList(e,"remove-btn").forEach((t=>{const a=t.data;t.button.onclick=async()=>{await this.confirm(`Biztos törli <strong> ${a.jogosultsag_neve} </strong>jogosultságot?`,t.button),await this.fetchDelete(this.url(o.REMOVE_FELHASZNALOI_JOGOK),a.id),e.dataSource.remove(a)}})),Array.from(e.wrapper[0].querySelectorAll("button.hozzarendeles-btn")).forEach((t=>{const a=t.closest("tr"),n=e.dataItem(a);t.onclick=async()=>{const e=this.url(o.HOZZARENDELES_FORM),t=new i;await t.hozzarendelesForm(n.id,e)}}))})),this.dataBound(e,(()=>{const t=e;this.gridButtonList(t,"edit-btn").forEach((e=>{const a=e.data;e.button.onclick=async()=>{const e=await this.felhasznalokForm({id:a.id});t.dataSource.pushUpdate(e.model)}})),this.gridButtonList(t,"remove-btn").forEach((e=>{const a=e.data;e.button.onclick=async()=>{await this.confirm(`Biztos törli <strong> ${a.felhasznaloi_nev} </strong>felhasználót?`,e.button),await this.fetchDelete(this.url(o.REMOVE_FELHASZNALO),a.id),t.dataSource.remove(a)}})),this.gridButtonList(t,"jelszo-valtoztatas-btn").forEach((e=>{const t=e.data;e.button.onclick=async()=>{const e=this.url(o.JELSZO_VALTOZTATAS_FORM),a=t.id,n=new s;await n.valtoztatasForm(a,e)}}))})),this.button("create-felhasznalo-btn").onclick=async()=>{const t=await this.felhasznalokForm();e.dataSource.insert(0,t.model)},this.button("create-felhasznaloi-jog-btn").onclick=async()=>{const e=await this.felhasznaloiJogokForm();t.dataSource.insert(0,e.model)},this.button("create-menu-btn").onclick=async()=>{await this.menuForm(),a.dataSource.read()}}async menuForm(e={}){const t=this.url(o.MENU_FORM),a=new r.h;a.root.innerHTML=await this.fetchData(t,e),jQuery(this.input("menu-sorrend")).kendoNumericTextBox({format:"n0",decimals:0,spinners:!1}),jQuery(this.input("menu-parent_id")).kendoDropDownList({filter:"contains",height:400,valueTemplate:e=>`${e.text.toString().replaceAll("-",'&nbsp;<i class="fa fa-arrow-right"></i>&nbsp;')}`,template:e=>`${e.text.toString().replaceAll("-",'&nbsp;<i class="fa fa-arrow-right"></i>&nbsp;')}`});const n=a.root.querySelector("button.save-btn");return new Promise((e=>{n.onclick=async()=>{const o=new FormData(a.form),n=await this.fetchForm(t,o,a.form,"menu");e(n),a.close()}}))}async felhasznaloiJogokForm(e={}){const t=this.url(o.FELHASZNALOI_JOGOK_FORM),a=new r.h;a.root.innerHTML=await this.fetchData(t,e);const n=a.root.querySelector("button.save-btn");return new Promise((e=>{n.onclick=async()=>{const o=new FormData(a.form),n=await this.fetchForm(t,o,a.form,"felhasznaloijogok");e(n),a.close()}}))}async felhasznalokForm(e={}){const t=new r.h,a=this.url(o.FELHASZNALOK_FORM);t.root.innerHTML=await this.fetchData(a,e),jQuery(this.input("felhasznalok-felhasznaloi_jog")).kendoDropDownList({filter:"contains"});const n=t.root.querySelector("button.save-btn");return new Promise((e=>{n.onclick=async()=>{const o=new FormData(t.form),n=await this.fetchForm(a,o,t.form,"felhasznalok");e(n),t.close()}}))}felhasznaloiJogokGrid(e){return new Promise((t=>{const a=this.schema,n=this.transport;n.read.url=this.url(o.FELHASZNALOI_JOGOK);const r=new kendo.data.DataSource({pageSize:100,transport:n,schema:a}),s=felhasznaloiJogokColumns;jQuery(e).kendoGrid({columns:s,dataSource:r,filterable:this.filterable,height:"100%",pageable:{refresh:!0},sortable:!0,dataBound:e=>t(e.sender)})}))}felhasznalokGrid(e){return new Promise((t=>{const a=this.schema,n=this.transport;console.log(this.url(o.FELHASZNALOK)),n.read.url=this.url(o.FELHASZNALOK);const r=new kendo.data.DataSource({pageSize:100,transport:n,schema:a}),s=felhasznalokColumns;jQuery(e).kendoGrid({columns:s,dataSource:r,filterable:this.filterable,height:"100%",sortable:!0,pageable:{refresh:!0},dataBound:e=>t(e.sender)})}))}menuGrid(e){return new Promise((t=>{const a=this.schema;a.model={id:"id",parentId:"parent_id",expanded:!0,fields:{parent_id:{nullable:!0,field:"parent_id"}}};const n=this.transport;n.read.url=this.url(o.MENU);const r=new kendo.data.TreeListDataSource({pageSize:100,transport:n,schema:a}),s=menuColumns;new ResizeObserver((()=>{const t=e.querySelector("div.k-grid-content");t&&(t.style.height=e.closest("div.admin-tab").clientHeight-184+"px")})).observe(e),jQuery(e).kendoTreeList({columns:s,dataSource:r,filterable:this.filterable,height:"100%",pageable:{refresh:!0},dataBound:e=>t(e.sender)})}))}}(new d).init()})();