(()=>{"use strict";var e={169:(e,t,o)=>{o.d(t,{h:()=>a});var r=o(725);class a extends r.h{constructor(e="Karsai autó",t="",o=800){super(),this.prev=document.querySelector("div.form-popup"),this.prev&&this.prev.classList.add("back"),this.root=document.createElement("div"),this.root.classList.add("form-popup"),this.root.style.width=`${o}px`,this.layer=document.createElement("div"),this.layer.classList.add("form-popup-layer");const r=document.createElement("style");r.innerText=this.style(),document.head.appendChild(r),document.body.appendChild(this.layer),this.layer.style.zIndex=(this.maxZIndex+1).toString(),document.body.appendChild(this.root),this.root.style.zIndex=(this.maxZIndex+1).toString();const a=new MutationObserver((()=>{const e=this.root.querySelector("div.close-box");e&&(e.onclick=()=>this.close(),e.style.cursor="pointer",this.form=this.root.querySelector("form"),a.disconnect()),requestAnimationFrame((()=>this.root.classList.add("active")))}));a.observe(this.root,{childList:!0})}style(){return".form-popup-layer {position: fixed;inset: 0;background: rgba(0, 0, 0, 0.2);}  .form-popup {background: transparent;position: absolute;top: 0;left: 50%;transition: 0.5s;transform: translateX(-50%) ;transform-origin: bottom;opacity: 0;pointer-events: none;}  .form-popup.back {transition-delay: 0.5s;transform: translateX(-52%) translateY(-10px)  !important;}  .form-popup > .card {opacity: 0;transition: 0.5s;}  .form-popup.active > .card {box-shadow: 0 10px 10px rgba(0, 0, 0, 0.2);border: none;opacity: 1;}  .form-popup.active {opacity: 1;top: 120px;pointer-events: all;transform: translateX(-50%) ;}  .form-popup .card-footer {display: flex;justify-content: flex-end;}  .form-popup .close-box i {transition: 0.5s;}  .form-popup .close-box:hover i {color: red;transform: rotate(360deg) scale(1.5);} "}close(){this.root.ontransitionend=e=>{"top"==e.propertyName&&(this.root.remove(),this.layer.remove(),this.prev&&this.prev.classList.remove("back"))},this.root.classList.remove("active")}}},725:(e,t,o)=>{o.d(t,{h:()=>r});class r{url(e){return`${(window.location.origin+window.location.pathname).replace(/\/+$/,"")}/${e}`}get schema(){return{model:{id:"id",fields:{}},data:e=>e.data||[],total:e=>e.total||0}}input(e){return document.getElementById(e)??document.createElement("button")}message(e){const t=Array.from(document.querySelectorAll("div.message-box")).reduce((e=>e+90),50),o=document.createElement("div");o.classList.add("message-box");const r=(new Date).toLocaleTimeString("hu-HU",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});o.style.zIndex=(this.maxZIndex+1).toString(),o.innerHTML=e+"&nbsp;"+r,o.style.top=`${t}px`,document.body.appendChild(o),o.ontransitionend=()=>{},requestAnimationFrame((()=>o.classList.add("active"))),o.onclick=()=>{o.ontransitionend=()=>o.remove(),o.classList.remove("active")},setTimeout((()=>{o.ontransitionend=()=>o.remove(),o.classList.remove("active")}),3e3)}showFormError(e,t,o){t.querySelectorAll("div.error-box").forEach((e=>e.remove()));for(const[r,a]of Object.entries(o)){const o=t.querySelector(`div.field-${e}-${r}`),n=document.createElement("div");n.classList.add("error-box"),n.style.zIndex=(this.maxZIndex+1).toString(),n.innerHTML=a[0],o&&(o.appendChild(n),requestAnimationFrame((()=>n.classList.add("show"))))}}gridButtonList(e,t){return Array.from(e.wrapper[0].querySelectorAll(`button.${t}`)).map((t=>{const o=t.closest("tr");return{button:t,row:o,data:e.dataItem(o)}}))}async fetchDelete(e,t){const o=await fetch(`${e}/${t}`,{method:"DELETE",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-Token":yii.getCsrfToken()}});let r;try{r=await o.json()}catch(e){r=null}if(200==o.status)return r;throw new Error(r?.message||"Sikertelen törlés")}async fetchForm(e,t,o=null,r=null,a=!0){return new Promise((n=>{const s=document.querySelector("div.form-popup");if(s){const e=document.createElement("div");e.classList.add("loader"),e.style.zIndex=(this.maxZIndex+1).toString(),e.innerHTML='˛<img alt="nincs" src="/images/YTup.gif">',s.appendChild(e)}const i=[200,201,202],d=document.createElement("div");let c;a&&(d.classList.add("popup-layer"),d.style.zIndex=(this.maxZIndex+1).toString(),document.body.appendChild(d),d.classList.add("animate")),t.append("_csrf",yii.getCsrfToken()),fetch(e,{method:"POST",body:t}).then((e=>{if(d&&(d.remove(),document.querySelectorAll("div.loader").forEach((e=>e.remove()))),c=e.status,(e.headers.get("Content-Type")||"").includes("application/json"))return e.json();throw new Error("A válasz nem JSON formátumú.")})).then((e=>{i.includes(c)?n(e):r&&o&&this.showFormError(r,o,e.errors)}))}))}async fetchData(e,t={},o=!0){const r=jQuery.Deferred(),a=new FormData,n=document.createElement("div");o&&(n.classList.add("popup-layer"),n.style.zIndex=(this.maxZIndex+1).toString(),document.body.appendChild(n),n.classList.add("animate")),a.append("_csrf",yii.getCsrfToken());for(const[e,o]of Object.entries(t))a.append(e,o);const s=await fetch(e,{headers:{"X-Requested-With":"XMLHttpRequest"},body:a,method:"POST"});if(403==s.status)return alert(await s.text()),document.querySelectorAll("div.form-popup-layer").forEach((e=>e.remove())),document.querySelectorAll("div.form-popup").forEach((e=>e.remove())),n&&n.remove(),!1;let i;const d=s.headers.get("content-type");return i="string"==typeof d&&d.includes("application/json")?await s.json():await s.text(),n&&n.remove(),r.resolve(i),r}urlPart(e){return`${new URL(window.location.href).pathname}/${e}`}get transport(){const e={};return e._csrf=yii.getCsrfToken(),{read:{type:"POST",url:null,data:e,dataType:"json"}}}confirm(e,t){const o=jQuery.Deferred(),r=jQuery(t).kendoPopover({body:()=>`<div class="confirm-body"><div>${e}</div><div><button class="btn btn-primary btn" data-name="no-btn">Nem</button><button class="btn btn-danger btn" data-name="yes-btn">Igen</button></div></div>`,position:"left",header:()=>"Megerősítés",showOn:"click",show:e=>{const t=e.sender.popup.element?.[0]?.querySelector('button[data-name="no-btn"]');t&&(t.onclick=()=>{e.sender.hide()});const r=e.sender.popup.element?.[0]?.querySelector('button[data-name="yes-btn"]');r&&(r.onclick=()=>{o.resolve(),e.sender.hide()})},hide:()=>{document.body.querySelectorAll("div.confirm-body").forEach((e=>{e.closest("div.k-animation-container")?.remove()}))}}).data("kendoPopover");return r&&r.show(),o}button(e){return document.getElementById(e)}div(e){return document.getElementById(e)}async delete(e,t){const o=new URL(window.location.origin+"/"+this.pascalToKebab(e));o.searchParams.append("id",t.toString());try{const e=await fetch(o.toString(),{method:"DELETE",headers:{"X-CSRF-Token":yii.getCsrfToken(),Accept:"application/json"}}),t=await e.json();return e.ok||console.error("Hiba a válaszban:",t.message||"Ismeretlen hiba történt."),t}catch(e){throw console.error("DELETE hiba:",e.message),e}}get maxZIndex(){let e=0;const t=document.getElementsByTagName("*");for(let o=0;o<t.length;o++){const r=window.getComputedStyle(t[o]).zIndex,a=parseInt(r,10);isNaN(a)||(e=Math.max(e,a))}return e}navigate(e,t="_self"){const o=document.createElement("a");o.href=e,document.body.appendChild(o),o.target=t,o.click(),o.remove()}pascalToKebab(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}grid(e,t,o=!0,r=[]){return new Promise((a=>{const n=this.schema,s=this.transport;s.read.url=t;const i=new kendo.data.DataSource({pageSize:100,transport:s,schema:n}),d=jQuery(e).kendoGrid({columns:r,dataSource:i,filterable:this.filterable,height:"100%",pageable:{refresh:!0},autoBind:o}).data("kendoGrid");if(!d)throw new Error("Failed to initialize kendoGrid.");o?d.bind("dataBound",(()=>a(d))):a(d)}))}igenNemFilter(e,t){jQuery(e).kendoDropDownList({dataValueField:"id",dataTextField:"value",optionLabel:"-----------",dataSource:new kendo.data.DataSource({data:JSON.parse(t.dataset.igennemFilter)})})}get filterable(){return{extra:!1,operators:{string:{contains:"Tartalmazza",eq:"Egyenlő"}}}}dataBound(e,t,o=!0){e.bind("dataBound",t),o&&t()}}}},t={};function o(r){var a=t[r];if(void 0!==a)return a.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,o),n.exports}o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r,a=o(725),n=o(169);!function(e){e.ARVALASZTO_FORM="ArvalasztoForm",e.ARVALASZTO="Arvalaszto"}(r||(r={}));class s extends a.h{async init(){const e=await this.arvalasztoGrid(this.div("arvalaszto-grid"));this.button("create-arvalaszto-btn").onclick=async()=>{await this.arvalasztoForm(),e.dataSource.read()}}arvalasztoGrid(e){return new Promise((t=>{const o=this.url(r.ARVALASZTO),a=this.schema,n=this.transport;n.read.url=o;const s=new kendo.data.DataSource({pageSize:100,transport:n,schema:a}),i=arvalasztoColumns;["kezdo_osszeg","veg_osszeg"].forEach((e=>{i.find((t=>t.field==e)).template=t=>t[e]?`${kendo.toString(t[e],"n0")} Ft`:""})),jQuery(e).kendoGrid({columns:i,dataSource:s,filterable:this.filterable,height:"100%",pageable:{refresh:!0},dataBound:e=>t(e.sender)})}))}async arvalasztoForm(e={}){const t=this.url(r.ARVALASZTO_FORM),o=new n.h;o.root.innerHTML=await this.fetchData(t,e),["arvalaszto-kezdo_osszeg","arvalaszto-veg_osszeg"].forEach((e=>{const t=document.getElementById(e);jQuery(t).kendoNumericTextBox({format:"n0",decimals:0})}));const a=o.root.querySelector("button.save-btn");return new Promise((e=>{a.onclick=async()=>{const r=new FormData(o.form),a=await this.fetchForm(t,r,o.form,"arvalaszto");e(a),o.close()}}))}}(new s).init()})();