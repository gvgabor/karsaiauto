(()=>{"use strict";var t={169:(t,e,o)=>{o.d(e,{h:()=>a});var r=o(725);class a extends r.h{constructor(t="Karsai autó",e="",o=800){super(),this.root=document.createElement("div"),this.root.classList.add("form-popup"),this.layer=document.createElement("div"),this.layer.classList.add("form-popup-layer");const r=document.createElement("style");r.innerText=`.form-popup-layer { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.2); } .form-popup { width: ${o}px; background: white; position: absolute; top: 0; left: 50%; transition: 0.5s; transform: translateX(-50%); box-shadow: 0 10px 10px rgba(0, 0, 0, 0.2); opacity: 0; pointer-events: none; } .form-popup.active { opacity: 1; top: 120px; pointer-events: all; } .form-popup .card-footer { display: flex; justify-content: flex-end; }`,document.head.appendChild(r),document.body.appendChild(this.layer),this.layer.style.zIndex=(this.maxZIndex+1).toString(),document.body.appendChild(this.root),this.root.style.zIndex=(this.maxZIndex+1).toString();const a=new MutationObserver((t=>{const e=this.root.querySelector("div.close-box");e&&(e.onclick=()=>this.close(),e.style.cursor="pointer",this.form=this.root.querySelector("form"),a.disconnect()),requestAnimationFrame((()=>this.root.classList.add("active")))}));a.observe(this.root,{childList:!0})}close(){this.root.ontransitionend=t=>{"top"==t.propertyName&&(this.root.remove(),this.layer.remove())},this.root.classList.remove("active")}}},725:(t,e,o)=>{o.d(e,{h:()=>r});class r{url(t){return`${(window.location.origin+window.location.pathname).replace(/\/+$/,"")}/${t}`}get schema(){return{model:{id:"id",fields:{id:{type:"number"}}},data:t=>t.data||[],total:t=>t.total||0}}input(t){return document.getElementById(t)??document.createElement("button")}showFormError(t,e,o){e.querySelectorAll("div.error-box").forEach((t=>t.remove()));for(const[r,a]of Object.entries(o)){const o=e.querySelector(`div.field-${t}-${r}`),n=document.createElement("div");n.classList.add("error-box"),n.innerHTML=a[0],o&&(o.appendChild(n),requestAnimationFrame((()=>n.classList.add("show"))))}}gridButtonList(t,e){return Array.from(t.wrapper[0].querySelectorAll(`button.${e}`)).map((e=>{const o=e.closest("tr");return{button:e,row:o,data:t.dataItem(o)}}))}async fetchDelete(t,e){const o=await fetch(`${t}/${e}`,{method:"DELETE",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-Token":yii.getCsrfToken()}});let r;try{r=await o.json()}catch(t){r=null}if(200==o.status)return r;throw new Error(r?.message||"Sikertelen törlés")}async fetchForm(t,e,o=null,r=null,a=!0){return new Promise((n=>{const s=[200,201,202],i=document.createElement("div");let d;a&&(i.classList.add("popup-layer"),i.style.zIndex=(this.maxZIndex+1).toString(),document.body.appendChild(i),i.classList.add("animate")),e.append("_csrf",yii.getCsrfToken()),fetch(t,{method:"POST",body:e}).then((t=>{if(i&&i.remove(),d=t.status,(t.headers.get("Content-Type")||"").includes("application/json"))return t.json();throw new Error("A válasz nem JSON formátumú.")})).then((t=>{s.includes(d)?n(t):r&&o&&this.showFormError(r,o,t.errors)}))}))}async fetchData(t,e={},o=!0){const r=jQuery.Deferred(),a=new FormData,n=document.createElement("div");o&&(n.classList.add("popup-layer"),n.style.zIndex=(this.maxZIndex+1).toString(),document.body.appendChild(n),n.classList.add("animate")),a.append("_csrf",yii.getCsrfToken());for(const[t,o]of Object.entries(e))a.append(t,o);const s=await fetch(t,{headers:{"X-Requested-With":"XMLHttpRequest"},body:a,method:"POST"});let i;const d=s.headers.get("content-type");return i="string"==typeof d&&d.includes("application/json")?await s.json():await s.text(),n&&n.remove(),r.resolve(i),r}urlPart(t){return`${new URL(window.location.href).pathname}/${t}`}get transport(){const t={};return t._csrf=yii.getCsrfToken(),{read:{type:"POST",url:null,data:t,dataType:"json"}}}confirm(t,e){const o=jQuery.Deferred(),r=jQuery(e).kendoPopover({body:()=>`<div class="confirm-body"><i class="fa fa-question-circle"></i><div>${t}</div><div><button class="btn btn-primary btn" data-name="no-btn">Nem</button><button class="btn btn-danger btn" data-name="yes-btn">Igen</button></div></div>`,width:400,position:"left",header:()=>"Megerősítés",showOn:"click",show:t=>{const e=t.sender.popup.element?.[0]?.querySelector('button[data-name="no-btn"]');e&&(e.onclick=()=>{t.sender.hide()});const r=t.sender.popup.element?.[0]?.querySelector('button[data-name="yes-btn"]');r&&(r.onclick=()=>{o.resolve(),t.sender.hide()})},hide:()=>{document.body.querySelectorAll("div.confirm-body").forEach((t=>{t.closest("div.k-animation-container")?.remove()}))}}).data("kendoPopover");return r&&r.show(),o}button(t){return document.getElementById(t)}div(t){return document.getElementById(t)}async delete(t,e){const o=new URL(window.location.origin+"/"+this.pascalToKebab(t));o.searchParams.append("id",e.toString());try{const t=await fetch(o.toString(),{method:"DELETE",headers:{"X-CSRF-Token":yii.getCsrfToken(),Accept:"application/json"}}),e=await t.json();if(!t.ok)throw console.error("Hiba a válaszban:",e.message||"Ismeretlen hiba történt."),new Error(e.message||"Ismeretlen hiba történt.");return e}catch(t){throw console.error("DELETE hiba:",t.message),t}}get maxZIndex(){let t=0;const e=document.getElementsByTagName("*");for(let o=0;o<e.length;o++){const r=window.getComputedStyle(e[o]).zIndex,a=parseInt(r,10);isNaN(a)||(t=Math.max(t,a))}return t}navigate(t,e="_self"){const o=document.createElement("a");o.href=t,document.body.appendChild(o),o.target=e,o.click(),o.remove()}pascalToKebab(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}grid(t,e,o=!0,r=[]){return new Promise((a=>{const n=this.schema,s=this.transport;s.read.url=e;const i=new kendo.data.DataSource({pageSize:100,transport:s,schema:n}),d=jQuery(t).kendoGrid({columns:r,dataSource:i,filterable:this.filterable,height:"100%",pageable:{refresh:!0},autoBind:o}).data("kendoGrid");if(!d)throw new Error("Failed to initialize kendoGrid.");o?d.bind("dataBound",(()=>a(d))):a(d)}))}get filterable(){return{extra:!1,operators:{string:{contains:"Tartalmazza",eq:"Egyenlő"}}}}dataBound(t,e,o=!0){t.bind("dataBound",e),o&&e()}}}},e={};function o(r){var a=e[r];if(void 0!==a)return a.exports;var n=e[r]={exports:{}};return t[r](n,n.exports,o),n.exports}o.d=(t,e)=>{for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var r,a=o(725),n=o(169);!function(t){t.AUTOK_FORM="AutokForm",t.AUTOK="Autok",t.REMOVE_AUTO="RemoveAuto",t.TIPUS_UPLOAD="upload"}(r||(r={}));class s extends a.h{async init(){const t=await this.autokGrid(this.div("autok-grid"));this.dataBound(t,(()=>{const e=t;this.gridButtonList(e,"remove-btn").forEach((t=>{const o=t.data;t.button.onclick=async()=>{await this.confirm(`˙Biztos törli a(z) ${o.hirdetes_cime} hírdetést?`,t.button),(await this.fetchData(this.url(r.REMOVE_AUTO),{id:o.id})).success&&e.dataSource.remove(o)}})),this.gridButtonList(e,"edit-btn").forEach((t=>{const o=t.data;t.button.onclick=async()=>{const t=await this.autoForm({id:o.id});e.dataSource.pushUpdate(t.model)}}))})),this.button("create-auto-btn").onclick=async()=>{const e=await this.autoForm();t.dataSource.pushInsert(0,e.model)}}async autoForm(t={}){const e=this.url(r.AUTOK_FORM),o=Math.min(document.body.offsetWidth-120,1600),a=new n.h("","",o);a.root.innerHTML=await this.fetchData(e,t);const s=jQuery(this.div("form-tab")).kendoTabStrip({animation:!1}).data("kendoTabStrip");["autok-jarmutipus_id","autok-marka_id","autok-motortipus_id","autok-valto_id"].forEach((t=>{const e=document.getElementById(t);jQuery(e).kendoDropDownList({filter:"contains"})})),["autok-kilometer","autok-teljesitmeny","autok-vetelar","autok-gyartasi_ev"].forEach((t=>{const e=document.getElementById(t);jQuery(e).kendoNumericTextBox({decimals:0,format:"n0"})})),["autok-muszaki_ervenyes"].forEach((t=>{const e=document.getElementById(t);jQuery(e).kendoDatePicker({format:"yyyy-MM",depth:"year",start:"year"})})),s.select(0);const i=s.wrapper[0].querySelector("div.k-tabstrip-content"),d=this.div("upload-kepek-box");d.style.height=`${i.offsetHeight}px`;const c=this.input("autok-image");d.dataset.images&&(JSON.parse(d.dataset.images).forEach((t=>{this.imageBox(d,t.name,t.image).dataset.id=t.id})),this.showOrder(d),this.sortImages(d)),c.onchange=()=>{const t=c.files;if(t){const e=new MutationObserver((()=>{const o=Array.from(d.children),a=o.reduce(((t,e)=>(e.dataset.tipus==r.TIPUS_UPLOAD&&t++,t)),0);t.length==a&&(o.forEach((t=>t.removeAttribute("data-tipus"))),this.showOrder(d),e.disconnect())}));e.observe(d,{childList:!0});for(let e=0;e<t.length;e++){const o=t[e],a=new FileReader;a.onload=t=>{this.imageBox(d,o.name,t.target?.result).dataset.tipus=r.TIPUS_UPLOAD},a.readAsDataURL(o)}this.sortImages(d)}};const l=a.root.querySelector("button.save-btn");return new Promise((t=>{l.onclick=async()=>{const o=new FormData(a.form),r=Array.from(d.children).map(((t,e)=>({index:e+1,name:t.dataset.name,id:t.dataset.id})));o.append("sorrend",JSON.stringify(r));const n=await this.fetchForm(e,o,a.form,"autok");t(n),a.close()}}))}sortImages(t){jQuery(t).kendoSortable({filter:".image-item-box",cursor:"move",cursorOffset:{top:-80,left:-100},hint:t=>{const e=t.clone().css({width:"200px",maxWidth:"200px",height:"160px"}).addClass("drag-hint");return e.find("img").css({width:"100%",height:"100%",objectFit:"cover",display:"block"}),e},placeholder:t=>t.clone().css({opacity:.3,width:"200px",height:"160px"}).addClass("placeholder").text("IDE JÖHET"),change:()=>this.showOrder(t)})}showOrder(t){t.querySelectorAll("div.image-item-box:not(.placeholder)").forEach(((t,e)=>{const o=t.querySelector("div.order-box");o&&(o.innerHTML=(e+1).toString())}))}imageBox(t,e,o){const r=document.createElement("div");r.classList.add("image-item-box"),r.dataset.name=e;const a=document.createElement("img"),n=document.createElement("div");n.classList.add("order-box"),a.src=o;const s=document.createElement("div");return s.innerHTML='<i class="fa-solid fa-trash-can"></i>',s.classList.add("remove-box"),r.appendChild(a),r.appendChild(n),r.appendChild(s),t.appendChild(r),s.onclick=async()=>{await this.confirm("Biztosan törli a képet?",s),r.remove(),this.showOrder(t)},r}autokGrid(t){return new Promise((e=>{const o=this.url(r.AUTOK),a=this.schema,n=this.transport;n.read.url=o;const s=new kendo.data.DataSource({pageSize:100,transport:n,schema:a}),i=autokColumns;jQuery(t).kendoGrid({columns:i,dataSource:s,filterable:this.filterable,height:"100%",pageable:{refresh:!0},dataBound:t=>e(t.sender)})}))}}(new s).init()})();