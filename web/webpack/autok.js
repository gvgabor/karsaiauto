(()=>{"use strict";var e={169:(e,t,o)=>{o.d(t,{h:()=>n});var a=o(725);class n extends a.h{constructor(e="Karsai autó",t="",o=800){super(),this.root=document.createElement("div"),this.root.classList.add("form-popup"),this.root.style.width=`${o}px`,this.layer=document.createElement("div"),this.layer.classList.add("form-popup-layer");const a=document.createElement("style");a.innerText=".form-popup-layer { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.2); } .form-popup { background: transparent; position: absolute; top: 0; left: 50%; transition: 0.5s; transform: translateX(-50%); opacity: 0; pointer-events: none; } .form-popup > .card { opacity: 0; transition: 0.5s; } .form-popup.active > .card { box-shadow: 0 10px 10px rgba(0, 0, 0, 0.2); border: none; opacity: 1; } .form-popup.active { opacity: 1; top: 120px; pointer-events: all; } .form-popup .card-footer { display: flex; justify-content: flex-end; } .form-popup .close-box i{ transition: 0.5s; } .form-popup .close-box:hover i { color: red; transform: rotate(360deg) scale(1.5); }\n",document.head.appendChild(a),document.body.appendChild(this.layer),this.layer.style.zIndex=(this.maxZIndex+1).toString(),document.body.appendChild(this.root),this.root.style.zIndex=(this.maxZIndex+1).toString();const n=new MutationObserver((()=>{const e=this.root.querySelector("div.close-box");e&&(e.onclick=()=>this.close(),e.style.cursor="pointer",this.form=this.root.querySelector("form"),n.disconnect()),requestAnimationFrame((()=>this.root.classList.add("active")))}));n.observe(this.root,{childList:!0})}close(){this.root.ontransitionend=e=>{"top"==e.propertyName&&(this.root.remove(),this.layer.remove())},this.root.classList.remove("active")}}},725:(e,t,o)=>{o.d(t,{h:()=>a});class a{url(e){return`${(window.location.origin+window.location.pathname).replace(/\/+$/,"")}/${e}`}get schema(){return{model:{id:"id",fields:{}},data:e=>e.data||[],total:e=>e.total||0}}input(e){return document.getElementById(e)??document.createElement("button")}message(e){const t=Array.from(document.querySelectorAll("div.message-box")).reduce((e=>e+90),50),o=document.createElement("div");o.classList.add("message-box");const a=(new Date).toLocaleTimeString("hu-HU",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});o.style.zIndex=(this.maxZIndex+1).toString(),o.innerHTML=e+"&nbsp;"+a,o.style.top=`${t}px`,document.body.appendChild(o),o.ontransitionend=()=>{},requestAnimationFrame((()=>o.classList.add("active"))),o.onclick=()=>{o.ontransitionend=()=>o.remove(),o.classList.remove("active")},setTimeout((()=>{o.ontransitionend=()=>o.remove(),o.classList.remove("active")}),3e3)}showFormError(e,t,o){t.querySelectorAll("div.error-box").forEach((e=>e.remove()));for(const[a,n]of Object.entries(o)){const o=t.querySelector(`div.field-${e}-${a}`),r=document.createElement("div");r.classList.add("error-box"),r.style.zIndex=(this.maxZIndex+1).toString(),r.innerHTML=n[0],o&&(o.appendChild(r),requestAnimationFrame((()=>r.classList.add("show"))))}}gridButtonList(e,t){return Array.from(e.wrapper[0].querySelectorAll(`button.${t}`)).map((t=>{const o=t.closest("tr");return{button:t,row:o,data:e.dataItem(o)}}))}async fetchDelete(e,t){const o=await fetch(`${e}/${t}`,{method:"DELETE",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-Token":yii.getCsrfToken()}});let a;try{a=await o.json()}catch(e){a=null}if(200==o.status)return a;throw new Error(a?.message||"Sikertelen törlés")}async fetchForm(e,t,o=null,a=null,n=!0){return new Promise((r=>{const s=document.querySelector("div.form-popup");if(s){const e=document.createElement("div");e.classList.add("loader"),e.style.zIndex=(this.maxZIndex+1).toString(),e.innerHTML='˛<img alt="nincs" src="/images/YTup.gif">',s.appendChild(e)}const i=[200,201,202],d=document.createElement("div");let c;n&&(d.classList.add("popup-layer"),d.style.zIndex=(this.maxZIndex+1).toString(),document.body.appendChild(d),d.classList.add("animate")),t.append("_csrf",yii.getCsrfToken()),fetch(e,{method:"POST",body:t}).then((e=>{if(d&&(d.remove(),document.querySelectorAll("div.loader").forEach((e=>e.remove()))),c=e.status,(e.headers.get("Content-Type")||"").includes("application/json"))return e.json();throw new Error("A válasz nem JSON formátumú.")})).then((e=>{i.includes(c)?r(e):a&&o&&this.showFormError(a,o,e.errors)}))}))}async fetchData(e,t={},o=!0){const a=jQuery.Deferred(),n=new FormData,r=document.createElement("div");o&&(r.classList.add("popup-layer"),r.style.zIndex=(this.maxZIndex+1).toString(),document.body.appendChild(r),r.classList.add("animate")),n.append("_csrf",yii.getCsrfToken());for(const[e,o]of Object.entries(t))n.append(e,o);const s=await fetch(e,{headers:{"X-Requested-With":"XMLHttpRequest"},body:n,method:"POST"});let i;const d=s.headers.get("content-type");return i="string"==typeof d&&d.includes("application/json")?await s.json():await s.text(),r&&r.remove(),a.resolve(i),a}urlPart(e){return`${new URL(window.location.href).pathname}/${e}`}get transport(){const e={};return e._csrf=yii.getCsrfToken(),{read:{type:"POST",url:null,data:e,dataType:"json"}}}confirm(e,t){const o=jQuery.Deferred(),a=jQuery(t).kendoPopover({body:()=>`<div class="confirm-body"><div>${e}</div><div><button class="btn btn-primary btn" data-name="no-btn">Nem</button><button class="btn btn-danger btn" data-name="yes-btn">Igen</button></div></div>`,position:"left",header:()=>"Megerősítés",showOn:"click",show:e=>{const t=e.sender.popup.element?.[0]?.querySelector('button[data-name="no-btn"]');t&&(t.onclick=()=>{e.sender.hide()});const a=e.sender.popup.element?.[0]?.querySelector('button[data-name="yes-btn"]');a&&(a.onclick=()=>{o.resolve(),e.sender.hide()})},hide:()=>{document.body.querySelectorAll("div.confirm-body").forEach((e=>{e.closest("div.k-animation-container")?.remove()}))}}).data("kendoPopover");return a&&a.show(),o}button(e){return document.getElementById(e)}div(e){return document.getElementById(e)}async delete(e,t){const o=new URL(window.location.origin+"/"+this.pascalToKebab(e));o.searchParams.append("id",t.toString());try{const e=await fetch(o.toString(),{method:"DELETE",headers:{"X-CSRF-Token":yii.getCsrfToken(),Accept:"application/json"}}),t=await e.json();return e.ok||console.error("Hiba a válaszban:",t.message||"Ismeretlen hiba történt."),t}catch(e){throw console.error("DELETE hiba:",e.message),e}}get maxZIndex(){let e=0;const t=document.getElementsByTagName("*");for(let o=0;o<t.length;o++){const a=window.getComputedStyle(t[o]).zIndex,n=parseInt(a,10);isNaN(n)||(e=Math.max(e,n))}return e}navigate(e,t="_self"){const o=document.createElement("a");o.href=e,document.body.appendChild(o),o.target=t,o.click(),o.remove()}pascalToKebab(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}grid(e,t,o=!0,a=[]){return new Promise((n=>{const r=this.schema,s=this.transport;s.read.url=t;const i=new kendo.data.DataSource({pageSize:100,transport:s,schema:r}),d=jQuery(e).kendoGrid({columns:a,dataSource:i,filterable:this.filterable,height:"100%",pageable:{refresh:!0},autoBind:o}).data("kendoGrid");if(!d)throw new Error("Failed to initialize kendoGrid.");o?d.bind("dataBound",(()=>n(d))):n(d)}))}get filterable(){return{extra:!1,operators:{string:{contains:"Tartalmazza",eq:"Egyenlő"}}}}dataBound(e,t,o=!0){e.bind("dataBound",t),o&&t()}}}},t={};function o(a){var n=t[a];if(void 0!==n)return n.exports;var r=t[a]={exports:{}};return e[a](r,r.exports,o),r.exports}o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var a,n=o(725),r=o(169);!function(e){e.AUTOK_FORM="AutokForm",e.AUTOK="Autok",e.REMOVE_AUTO="RemoveAuto",e.TIPUS_UPLOAD="upload",e.ELADVA_FORM="EladvaForm",e.DOKUMENTUMOK_DATASOURCE="DokumentumokDatasource"}(a||(a={}));class s extends n.h{async init(){const e=await this.autokGrid(this.div("autok-grid"));this.dataBound(e,(()=>{const t=e;this.gridButtonList(t,"remove-btn").forEach((e=>{const o=e.data;e.button.onclick=async()=>{await this.confirm(o.confirm_text,e.button),(await this.fetchData(this.url(a.REMOVE_AUTO),{id:o.id})).success&&(t.dataSource.remove(o),this.message(o.delete_text))}})),this.gridButtonList(t,"edit-btn").forEach((e=>{const o=e.data;e.button.onclick=async()=>{const e=await this.autoForm({id:o.id});t.dataSource.pushUpdate(e.model),t.dataSource.fetch(),this.message(o.edit_text)}})),this.gridButtonList(t,"eladva-btn").forEach((e=>{const t=e.data;e.button.onclick=()=>{this.eladvaForm({id:t.id})}}))})),this.button("create-auto-btn").onclick=async()=>{const t=await this.autoForm();e.dataSource.pushInsert(0,t.model)}}async eladvaForm(e={}){const t=this.url(a.ELADVA_FORM);(new r.h).root.innerHTML=await this.fetchData(t,e)}async autoForm(e={}){const t=this.url(a.AUTOK_FORM),o=Math.min(document.body.offsetWidth-120,1600),n=new r.h("","",o);n.root.innerHTML=await this.fetchData(t,e);const s=jQuery(this.div("form-tab")).kendoTabStrip({animation:!1}).data("kendoTabStrip");["autokmodel-jarmutipus_id","autokmodel-marka_id","autokmodel-motortipus_id","autokmodel-valto_id"].forEach((e=>{const t=document.getElementById(e);jQuery(t).kendoDropDownList({filter:"contains"})})),["autokmodel-kilometer","autokmodel-teljesitmeny","autokmodel-vetelar","autokmodel-gyartasi_ev"].forEach((e=>{const t=document.getElementById(e);jQuery(t).kendoNumericTextBox({decimals:0,format:"n0"})})),["autokmodel-muszaki_ervenyes"].forEach((e=>{const t=document.getElementById(e);jQuery(t).kendoDatePicker({format:"yyyy-MM",depth:"year",start:"year"})})),s.select(0);const i=await this.dokumentumokGrid(this.div("dokumentumok-grid"));this.dataBound(i,(()=>{const e=i;this.gridButtonList(e,"remove-btn").forEach((t=>{const o=t.data;t.button.onclick=async()=>{await this.confirm(t.button.parentElement.dataset.deleteText||"",t.button),e.dataSource.remove(o)}})),this.gridButtonList(e,"view-btn").forEach((e=>{const t=e.data;e.button.disabled=!t.id,e.button.onclick=()=>{this.navigate(t.dokumentumUrl,"_blank")}}))}));let d=s.wrapper[0].querySelector("div.k-tabstrip-content.k-active");const c=this.div("upload-kepek-box");new ResizeObserver((()=>{d=s.wrapper[0].querySelector("div.k-tabstrip-content.k-active"),c.style.height=`${d.offsetHeight}px`})).observe(d);const l=this.input("autokmodel-dokumentumok");l.onchange=()=>{const e=l.files;Array.from(e).forEach((e=>{const t=e.name.substring(0,e.name.lastIndexOf(".")),o={extension:e.name.substring(e.name.lastIndexOf(".")+1),name:t,uploadName:e.name,file:e};i.dataSource.insert(0,o)})),l.value=""};const m=this.input("autokmodel-image");c.dataset.images&&(JSON.parse(c.dataset.images).forEach((e=>{this.imageBox(c,e.name,e.image).dataset.id=e.id})),this.showOrder(c),this.sortImages(c)),m.onchange=()=>{const e=m.files;if(e){const t=new MutationObserver((()=>{const o=Array.from(c.children),n=o.reduce(((e,t)=>(t.dataset.tipus==a.TIPUS_UPLOAD&&e++,e)),0);e.length==n&&(o.forEach((e=>e.removeAttribute("data-tipus"))),this.showOrder(c),t.disconnect())}));t.observe(c,{childList:!0});for(let t=0;t<e.length;t++){const o=e[t],n=new FileReader;n.onload=e=>{this.imageBox(c,o.name,e.target?.result).dataset.tipus=a.TIPUS_UPLOAD},n.readAsDataURL(o)}this.sortImages(c)}};const u=n.root.querySelector("button.save-btn");return new Promise((e=>{u.onclick=async()=>{const o=new FormData(n.form),a=Array.from(c.children).map(((e,t)=>({index:t+1,name:e.dataset.name,id:e.dataset.id})));o.append("sorrend",JSON.stringify(a));const r=i.dataSource.data().toJSON();o.append("dokumentumok",JSON.stringify(r)),i.dataSource.data().map((e=>e.file)).forEach(((e,t)=>{o.append(`dokumetumokFiles[${t}]`,e)}));const s=await this.fetchForm(t,o,n.form,"autokmodel");e(s),n.close()}}))}dokumentumokGrid(e){return new Promise((t=>{const o=this.url(a.DOKUMENTUMOK_DATASOURCE),n=this.schema;n.model={id:"id",fields:{extension:{editable:!1}}};const r=this.transport;r.read.url=o,r.read.data.autokId=e.dataset.autokId;const s=new kendo.data.DataSource({pageSize:100,transport:r,schema:n}),i=dokumentumokColumns;jQuery(e).kendoGrid({columns:i,dataSource:s,filterable:this.filterable,height:800,pageable:{refresh:!1},editable:!0,dataBound:e=>t(e.sender),navigatable:!0})}))}sortImages(e){jQuery(e).kendoSortable({filter:".image-item-box",cursor:"move",cursorOffset:{top:-80,left:-100},hint:e=>{const t=e.clone().css({width:"200px",maxWidth:"200px",height:"160px"}).addClass("drag-hint");return t.find("img").css({width:"100%",height:"100%",objectFit:"cover",display:"block"}),t},placeholder:e=>e.clone().css({opacity:.3,width:"200px",height:"160px"}).addClass("placeholder").text("IDE JÖHET"),change:()=>this.showOrder(e)})}showOrder(e){e.querySelectorAll("div.image-item-box:not(.placeholder)").forEach(((e,t)=>{const o=e.querySelector("div.order-box");o&&(o.innerHTML=(t+1).toString())}))}imageBox(e,t,o){const a=document.createElement("div");a.classList.add("image-item-box"),a.dataset.name=t;const n=document.createElement("img"),r=document.createElement("div");r.classList.add("order-box"),n.src=o;const s=document.createElement("div");return s.innerHTML='<i class="fa-solid fa-trash-can"></i>',s.classList.add("remove-box"),a.appendChild(n),a.appendChild(r),a.appendChild(s),e.appendChild(a),s.onclick=async()=>{await this.confirm("Biztosan törli a képet?",s),a.remove(),this.showOrder(e)},a}autokGrid(e){return new Promise((t=>{const o=this.url(a.AUTOK),n=this.schema,r=this.transport;r.read.url=o;const s=new kendo.data.DataSource({pageSize:100,transport:r,schema:n,serverPaging:!0,serverFiltering:!0}),i=autokColumns;i.find((e=>"vetelar"==e.field)).template=e=>`${kendo.toString(parseInt(e.vetelar),"n0")} Ft`,jQuery(e).kendoGrid({columns:i,dataSource:s,filterable:this.filterable,height:"100%",pageable:{refresh:!0},dataBound:e=>t(e.sender)})}))}}(new s).init()})();